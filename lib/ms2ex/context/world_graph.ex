defmodule Ms2ex.WorldGraph do
  @table :world_graph

  def get_shortest_path(src_id, dst_id) do
    case Graph.get_shortest_path(get!(), src_id, dst_id) do
      nil -> :error
      path -> {:ok, path, Enum.count(path)}
    end
  end

  def get!() do
    [{_, graph}] = :ets.lookup(@table, :data)
    graph
  end

  def store() do
    :ets.new(@table, [:protected, :set, :named_table])
    :ets.insert(@table, {:data, build()})
  end

  defp build() do
    Graph.new()

    # victoria island
    |> add_edge(2_000_062, 2_000_114)
    |> add_edge(2_000_114, 2_000_115)
    |> add_edge(2_000_115, 2_000_116)
    |> add_edge(2_000_116, 2_000_117)
    |> add_edge(2_000_117, 2_000_118)
    |> add_edge(2_000_118, 2_000_001)
    |> add_edge(2_000_001, 2_000_487)
    |> add_edge(2_000_001, 2_000_002)
    |> add_edge(2_000_001, 2_000_064)
    |> add_edge(2_000_001, 2_000_119)
    |> add_edge(2_000_001, 2_000_107)
    |> add_edge(2_020_004, 2_020_001)
    |> add_edge(2_000_107, 2_000_119)
    |> add_edge(2_000_014, 2_000_119)
    |> add_edge(2_000_014, 2_000_134)
    |> add_edge(2_000_014, 2_000_092)
    |> add_edge(2_000_134, 2_000_092)
    |> add_edge(2_000_092, 2_000_135)
    |> add_edge(2_000_092, 2_000_084)
    |> add_edge(2_000_092, 2_000_083)
    |> add_edge(2_000_092, 2_000_119)
    |> add_edge(2_000_135, 2_000_136)
    |> add_edge(2_000_136, 2_000_145)
    |> add_edge(2_000_136, 2_000_266)
    |> add_edge(2_000_136, 2_000_137)
    |> add_edge(2_000_146, 2_000_145)
    |> add_edge(2_000_146, 2_000_136)
    |> add_edge(2_000_146, 2_000_402)
    |> add_edge(2_000_402, 2_000_496)
    |> add_edge(2_000_266, 2_000_137)
    |> add_edge(2_000_266, 2_000_265)
    |> add_edge(2_000_266, 2_000_279)
    |> add_edge(2_000_279, 2_000_265)
    |> add_edge(2_000_279, 2_000_162)
    |> add_edge(2_000_162, 2_000_269)
    |> add_edge(2_000_162, 2_000_271)
    |> add_edge(2_000_162, 2_000_265)
    |> add_edge(2_000_271, 2_000_272)
    |> add_edge(2_000_271, 2_000_269)
    |> add_edge(2_000_271, 2_000_270)
    |> add_edge(2_000_271, 2_000_163)
    |> add_edge(2_000_270, 2_000_273)
    |> add_edge(2_000_273, 2_000_274)
    |> add_edge(2_000_274, 2_000_275)
    |> add_edge(2_000_274, 2_000_276)
    |> add_edge(2_000_276, 2_000_187)
    |> add_edge(2_000_276, 2_000_163)
    |> add_edge(2_000_187, 2_000_277)
    |> add_edge(2_000_187, 2_000_163)
    |> add_edge(2_000_277, 2_000_163)
    |> add_edge(2_000_269, 2_000_163)
    |> add_edge(2_000_265, 2_000_148)
    |> add_edge(2_000_265, 2_000_167)
    |> add_edge(2_000_138, 2_000_137)
    |> add_edge(2_000_138, 2_000_139)
    |> add_edge(2_000_139, 2_000_148)
    |> add_edge(2_000_139, 2_000_147)
    |> add_edge(2_000_139, 2_000_110)
    |> add_edge(2_000_110, 2_000_084)
    |> add_edge(2_000_110, 2_000_086)
    |> add_edge(2_000_083, 2_000_041)
    |> add_edge(2_000_083, 2_000_084)
    |> add_edge(2_000_017, 2_000_064)
    |> add_edge(2_000_017, 2_000_041)
    |> add_edge(2_000_017, 2_000_043)
    |> add_edge(2_000_111, 2_000_086)
    |> add_edge(2_000_111, 2_000_085)
    |> add_edge(2_000_085, 2_000_043)
    |> add_edge(2_000_085, 2_000_059)
    |> add_edge(2_000_085, 2_000_054)
    |> add_edge(2_000_059, 2_000_043)
    |> add_edge(2_000_059, 2_000_054)
    |> add_edge(2_000_059, 2_000_003)
    |> add_edge(2_000_100, 2_000_148)
    |> add_edge(2_000_100, 2_000_167)
    |> add_edge(2_000_100, 2_000_164)
    |> add_edge(2_000_100, 2_000_216)
    |> add_edge(2_000_100, 2_000_166)
    |> add_edge(2_000_100, 2_000_147)
    |> add_edge(2_000_100, 2_000_165)
    |> add_edge(2_000_216, 2_000_164)
    |> add_edge(2_000_216, 2_000_167)
    |> add_edge(2_000_147, 2_000_091)
    |> add_edge(2_000_147, 2_000_165)
    |> add_edge(2_000_166, 2_000_165)
    |> add_edge(2_000_166, 2_000_142)
    |> add_edge(2_000_166, 2_000_184)
    |> add_edge(2_000_166, 2_000_231)
    |> add_edge(2_000_231, 2_000_184)
    |> add_edge(2_000_231, 2_000_255)
    |> add_edge(2_000_231, 2_000_280)
    |> add_edge(2_000_231, 2_000_018)
    |> add_edge(2_000_262, 2_000_018)
    |> add_edge(2_000_262, 2_000_280)
    |> add_edge(2_000_280, 2_000_255)
    |> add_edge(2_000_280, 2_000_257)
    |> add_edge(2_000_258, 2_000_259)
    |> add_edge(2_000_258, 2_000_257)
    |> add_edge(2_000_255, 2_000_184)
    |> add_edge(2_000_255, 2_000_257)
    |> add_edge(2_000_255, 2_000_142)
    |> add_edge(2_000_142, 2_000_184)
    |> add_edge(2_000_142, 2_000_165)
    |> add_edge(2_000_142, 2_000_008)
    |> add_edge(2_000_185, 2_000_165)
    |> add_edge(2_000_185, 2_000_186)
    |> add_edge(2_000_185, 2_000_007)
    |> add_edge(2_000_007, 2_000_008)
    |> add_edge(2_000_007, 2_000_009)
    |> add_edge(2_000_007, 2_000_021)
    |> add_edge(2_000_038, 2_000_021)
    |> add_edge(2_000_038, 2_000_009)
    |> add_edge(2_000_009, 2_000_021)
    |> add_edge(2_000_015, 2_000_021)
    |> add_edge(2_000_015, 2_000_013)
    |> add_edge(2_000_105, 2_000_013)
    |> add_edge(2_000_076, 2_000_054)
    |> add_edge(2_000_076, 2_000_104)
    |> add_edge(2_000_076, 2_000_105)
    |> add_edge(2_000_076, 2_000_203)
    |> add_edge(2_000_076, 2_000_143)
    |> add_edge(2_000_143, 2_000_203)
    |> add_edge(2_000_143, 2_000_057)
    |> add_edge(2_000_057, 2_000_186)
    |> add_edge(2_000_057, 2_000_091)
    |> add_edge(2_000_002, 2_000_087)
    |> add_edge(2_000_002, 2_000_088)
    |> add_edge(2_000_088, 2_000_087)
    |> add_edge(2_000_088, 2_000_006)
    |> add_edge(2_000_006, 2_000_089)
    |> add_edge(2_000_006, 2_000_036)
    |> add_edge(2_000_006, 2_000_101)
    |> add_edge(2_000_023, 2_000_129)
    |> add_edge(2_000_023, 2_000_005)
    |> add_edge(2_000_023, 2_000_036)
    |> add_edge(2_000_023, 2_000_101)
    |> add_edge(2_000_023, 2_000_102)
    |> add_edge(2_000_023, 2_000_112)
    |> add_edge(2_000_036, 2_000_101)
    |> add_edge(2_000_036, 2_000_005)
    |> add_edge(2_000_005, 2_000_129)
    |> add_edge(2_000_005, 2_000_113)
    |> add_edge(2_000_005, 2_000_042)
    |> add_edge(2_000_042, 2_000_113)
    |> add_edge(2_000_042, 2_000_063)
    |> add_edge(2_000_042, 2_000_182)
    |> add_edge(2_000_042, 2_000_183)
    |> add_edge(2_000_182, 2_000_183)
    |> add_edge(2_000_113, 2_000_129)
    |> add_edge(2_000_113, 2_000_063)
    |> add_edge(2_000_067, 2_000_063)
    |> add_edge(2_000_067, 2_000_377)
    |> add_edge(2_000_129, 2_000_112)
    |> add_edge(2_000_181, 2_000_180)
    |> add_edge(2_000_181, 2_000_129)
    |> add_edge(2_000_131, 2_000_180)
    |> add_edge(2_000_131, 2_000_132)
    |> add_edge(2_000_132, 2_000_108)
    |> add_edge(2_000_132, 2_000_278)
    |> add_edge(2_000_214, 2_000_172)
    |> add_edge(2_000_214, 2_000_278)
    |> add_edge(2_000_172, 2_000_053)
    |> add_edge(2_000_172, 2_000_102)
    |> add_edge(2_000_172, 2_000_090)
    |> add_edge(2_000_053, 2_000_090)
    |> add_edge(2_000_053, 2_000_102)
    |> add_edge(2_000_102, 2_000_112)
    |> add_edge(2_000_103, 2_000_090)
    |> add_edge(2_000_103, 2_000_060)
    |> add_edge(2_000_103, 2_000_048)
    |> add_edge(2_000_060, 2_000_048)
    |> add_edge(2_000_060, 2_000_004)
    |> add_edge(2_000_024, 2_000_004)
    |> add_edge(2_000_024, 2_000_101)
    |> add_edge(2_000_024, 2_000_215)
    |> add_edge(2_000_022, 2_000_215)
    |> add_edge(2_000_022, 2_000_130)
    |> add_edge(2_000_022, 2_000_128)
    |> add_edge(2_000_130, 2_000_003)
    |> add_edge(2_000_128, 2_000_096)
    |> add_edge(2_000_095, 2_000_096)
    |> add_edge(2_000_095, 2_000_046)
    |> add_edge(2_000_046, 2_000_050)
    |> add_edge(2_000_046, 2_000_045)
    |> add_edge(2_000_039, 2_000_045)
    |> add_edge(2_000_039, 2_000_056)
    |> add_edge(2_000_056, 2_000_054)
    |> add_edge(2_000_056, 2_000_104)
    |> add_edge(2_000_104, 2_000_058)
    |> add_edge(2_000_173, 2_000_058)
    |> add_edge(2_000_173, 2_000_174)
    |> add_edge(2_000_174, 2_000_256)
    |> add_edge(2_000_175, 2_000_256)
    |> add_edge(2_000_175, 2_000_040)
    |> add_edge(2_000_175, 2_000_192)
    |> add_edge(2_000_011, 2_000_040)
    |> add_edge(2_000_011, 2_000_268)
    |> add_edge(2_000_268, 2_000_200)
    |> add_edge(2_000_268, 2_000_235)
    |> add_edge(2_000_236, 2_000_235)
    |> add_edge(2_000_236, 2_000_416)
    |> add_edge(2_000_417, 2_000_416)
    |> add_edge(2_000_417, 2_000_418)
    |> add_edge(2_000_176, 2_000_192)
    |> add_edge(2_000_176, 2_000_261)
    |> add_edge(2_000_260, 2_000_261)
    |> add_edge(2_000_260, 2_000_263)
    |> add_edge(2_000_260, 2_000_264)
    |> add_edge(2_000_264, 2_000_263)
    |> add_edge(2_000_264, 2_000_415)
    |> add_edge(2_000_414, 2_000_415)
    |> add_edge(2_000_414, 2_000_413)
    |> add_edge(2_000_412, 2_000_413)
    |> add_edge(2_000_412, 2_000_411)
    |> add_edge(2_000_044, 2_000_411)
    |> add_edge(2_000_044, 2_000_171)
    |> add_edge(2_000_044, 2_000_093)
    |> add_edge(2_000_170, 2_000_171)
    |> add_edge(2_000_170, 2_000_169)
    |> add_edge(2_000_097, 2_000_093)
    |> add_edge(2_000_097, 2_000_061)
    |> add_edge(2_000_061, 2_000_133)
    |> add_edge(2_000_061, 2_000_094)
    |> add_edge(2_000_094, 2_000_168)
    |> add_edge(2_000_094, 2_000_049)
    |> add_edge(2_000_049, 2_000_169)
    |> add_edge(2_000_051, 2_000_049)
    |> add_edge(2_000_051, 2_000_168)
    |> add_edge(2_000_051, 2_000_217)
    |> add_edge(2_000_051, 2_000_267)
    |> add_edge(2_000_051, 2_000_010)
    |> add_edge(2_000_051, 2_000_050)
    |> add_edge(2_000_010, 2_000_050)
    |> add_edge(2_000_010, 2_000_048)
    |> add_edge(2_000_048, 2_000_267)

    # Karkar island
    |> add_edge(2_010_002, 2_010_010)
    |> add_edge(2_010_002, 2_010_084)
    |> add_edge(2_010_002, 2_010_009)
    |> add_edge(2_010_014, 2_010_019)
    |> add_edge(2_010_014, 2_010_010)
    |> add_edge(2_010_043, 2_010_084)
    |> add_edge(2_010_012, 2_010_009)
    |> add_edge(2_010_012, 2_010_039)
    |> add_edge(2_010_038, 2_010_039)
    |> add_edge(2_010_038, 2_010_036)
    |> add_edge(2_010_063, 2_010_036)
    |> add_edge(2_010_063, 2_010_023)
    |> add_edge(2_010_023, 2_010_033)
    |> add_edge(2_010_023, 2_010_036)

    # Kritias
    |> add_edge(2_020_041, 2_020_004)
    |> add_edge(2_020_041, 2_020_031)
    |> add_edge(2_020_041, 2_020_032)
    |> add_edge(2_020_041, 2_020_013)
    |> add_edge(2_020_031, 2_020_030)
    |> add_edge(2_020_030, 2_020_029)
    |> add_edge(2_020_032, 2_020_010)
    |> add_edge(2_020_051, 2_020_013)
    |> add_edge(2_020_051, 2_020_032)
    |> add_edge(2_020_051, 2_020_003)
    |> add_edge(2_020_008, 2_020_003)
    |> add_edge(2_020_008, 2_020_018)
    |> add_edge(2_020_008, 2_020_035)
    |> add_edge(2_020_033, 2_020_018)
    |> add_edge(2_020_033, 2_020_017)
    |> add_edge(2_020_016, 2_020_017)
    |> add_edge(2_020_016, 2_020_013)
  end

  defp add_edge(g, v1, v2) do
    g
    |> Graph.add_edge(v1, v2)
    |> Graph.add_edge(v2, v1)
  end
end
